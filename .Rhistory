{
if(low <= stoploss)
{
newr$closetime = time
newr$close = stoploss
newr$exittype = 'longloss'
flag = T
}
}
else if(type == 'short')
{
if(high >= stoploss)
{
newr$closetime = time
newr$close = stoploss
newr$exittype = 'shortloss'
flag = T
}
}
result = list(flag = flag,r = newr)
print(result)
exit(0)
return(result)
}
defaultstopwin = function(r,d,state,point=5)
{
stopwin = r$stopwin
type = r$type
high = as.numeric(d$High)
low = as.numeric(d$Low)
time = as.character(index(d))
newr = r
flag = F
if(type == 'long')
{
if(high >= stopwin)
{
newr$closetime = time
newr$close = stopwin
newr$exittype = 'longwin'
flag = T
}
}
else if(type == 'short')
{
if(low <= stopwin)
{
newr$closetime = time
newr$close = stopwin
newr$exittype = 'shortwin'
flag = T
}
}
result = list(flag = flag,r = newr)
return(result)
}
nbarstate = NbarState$new()
position = Position$new()
for(i in 1:1000)#nrow(data))
{
print(i)
d = data[i,]
position$update(d,nbarstate)
position = nbar_strategy(d,position,nbarstate)
nbarstate$update(d)
}
defaultstoploss = function(r,d,state,point=5)
{
stoploss = r$stoploss
type = r$type
high = as.numeric(d$High)
low = as.numeric(d$Low)
time = as.character(index(d))
newr = r
flag = F
if(type == 'long')
{
if(low <= stoploss)
{
newr$closetime = time
newr$close = stoploss
newr$exittype = 'longloss'
flag = T
}
}
else if(type == 'short')
{
if(high >= stoploss)
{
newr$closetime = time
newr$close = stoploss
newr$exittype = 'shortloss'
flag = T
print(newr)
exit(0)
}
}
result = list(flag = flag,r = newr)
return(result)
}
defaultstopwin = function(r,d,state,point=5)
{
stopwin = r$stopwin
type = r$type
high = as.numeric(d$High)
low = as.numeric(d$Low)
time = as.character(index(d))
newr = r
flag = F
if(type == 'long')
{
if(high >= stopwin)
{
newr$closetime = time
newr$close = stopwin
newr$exittype = 'longwin'
flag = T
}
}
else if(type == 'short')
{
if(low <= stopwin)
{
newr$closetime = time
newr$close = stopwin
newr$exittype = 'shortwin'
flag = T
}
}
result = list(flag = flag,r = newr)
return(result)
}
nbarstate = NbarState$new()
position = Position$new()
for(i in 1:1000)#nrow(data))
{
print(i)
d = data[i,]
position$update(d,nbarstate)
position = nbar_strategy(d,position,nbarstate)
nbarstate$update(d)
}
Trade = R6Class('Trade',
public = list(
record = NULL,
stopwin = NULL,
stoploss = NULL,
movestop = NULL,
normalexit = NULL,
initialize = function(r,stopwin=NULL,stoploss=NULL,movestop=NULL,normalexit=NULL)
{
self$record = r
self$stoploss = stoploss
self$stopwin = stopwin
self$movestop = movestop
self$normalexit = normalexit
},
update = function(d,state,...)
{
r = self$record
flag = F
if(!is.null(self$stoploss))
{
result = self$stoploss(r,d,state)
self$record = result[['r']]
flag = result[['flag']]
}
else if(!is.null(self$stopwin))
{
result = self$stopwin(r,d,state)
self$record = result[['r']]
flag = result[['flag']]
}
else if(!is.null(self$normalexit))
{
result = self$normalexit(r,d,state)
self$record = result[['r']]
flag = result[['flag']]
}
else if(!is.null(self$movestop))
{
self$movestop(r,d,state)
}
return(flag)
}
)
)
defaultstoploss = function(r,d,state,point=5)
{
stoploss = r$stoploss
type = r$type
high = as.numeric(d$High)
low = as.numeric(d$Low)
time = as.character(index(d))
newr = r
flag = F
if(type == 'long')
{
if(low <= stoploss)
{
newr$closetime = time
newr$close = stoploss
newr$exittype = 'longloss'
flag = T
}
}
else if(type == 'short')
{
if(high >= stoploss)
{
newr$closetime = time
newr$close = stoploss
newr$exittype = 'shortloss'
flag = T
}
}
result = list(flag = flag,r = newr)
return(result)
}
defaultstopwin = function(r,d,state,point=5)
{
stopwin = r$stopwin
type = r$type
high = as.numeric(d$High)
low = as.numeric(d$Low)
time = as.character(index(d))
newr = r
flag = F
if(type == 'long')
{
if(high >= stopwin)
{
newr$closetime = time
newr$close = stopwin
newr$exittype = 'longwin'
flag = T
}
}
else if(type == 'short')
{
if(low <= stopwin)
{
newr$closetime = time
newr$close = stopwin
newr$exittype = 'shortwin'
flag = T
}
}
result = list(flag = flag,r = newr)
return(result)
}
nbarstate = NbarState$new()
position = Position$new()
for(i in 1:1000)#nrow(data))
{
print(i)
d = data[i,]
position$update(d,nbarstate)
position = nbar_strategy(d,position,nbarstate)
nbarstate$update(d)
}
position$records
nbarstate = NbarState$new()
position = Position$new()
for(i in 1:3000)#nrow(data))
{
print(i)
d = data[i,]
position$update(d,nbarstate)
position = nbar_strategy(d,position,nbarstate)
nbarstate$update(d)
}
position$records
flag
flag == F
Trade = R6Class('Trade',
public = list(
record = NULL,
stopwin = NULL,
stoploss = NULL,
movestop = NULL,
normalexit = NULL,
initialize = function(r,stopwin=NULL,stoploss=NULL,movestop=NULL,normalexit=NULL)
{
self$record = r
self$stoploss = stoploss
self$stopwin = stopwin
self$movestop = movestop
self$normalexit = normalexit
},
update = function(d,state,...)
{
r = self$record
flag = F
if(!is.null(self$stoploss))
{
result = self$stoploss(r,d,state)
self$record = result[['r']]
flag = result[['flag']]
}
if(!is.null(self$stopwin) && flag == F)
{
result = self$stopwin(r,d,state)
self$record = result[['r']]
flag = result[['flag']]
}
if(!is.null(self$normalexit) && flag == F)
{
result = self$normalexit(r,d,state)
self$record = result[['r']]
flag = result[['flag']]
}
if(!is.null(self$movestop) && flag == F)
{
self$movestop(r,d,state)
}
return(flag)
}
)
)
nbarstate = NbarState$new()
position = Position$new()
for(i in 1:3000)#nrow(data))
{
print(i)
d = data[i,]
position$update(d,nbarstate)
position = nbar_strategy(d,position,nbarstate)
nbarstate$update(d)
}
position$records
defaultstoploss = function(r,d,state,point=5)
{
stoploss = r$stoploss
type = r$type
high = as.numeric(d$High)
low = as.numeric(d$Low)
time = as.character(index(d))
newr = r
flag = F
if(type == 'long')
{
if(low <= stoploss)
{
newr$closetime = time
newr$close = stoploss
newr$exittype = 'longloss'
flag = T
}
}
else if(type == 'short')
{
if(high >= stoploss)
{
newr$closetime = time
newr$close = stoploss
newr$exittype = 'shortloss'
flag = T
}
}
result = list(flag = flag,r = newr)
return(result)
}
defaultstopwin = function(r,d,state,point=6)
{
stopwin = r$stopwin
type = r$type
high = as.numeric(d$High)
low = as.numeric(d$Low)
time = as.character(index(d))
newr = r
flag = F
if(type == 'long')
{
if(high >= stopwin)
{
newr$closetime = time
newr$close = stopwin
newr$exittype = 'longwin'
flag = T
}
}
else if(type == 'short')
{
if(low <= stopwin)
{
newr$closetime = time
newr$close = stopwin
newr$exittype = 'shortwin'
flag = T
}
}
result = list(flag = flag,r = newr)
return(result)
}
nbarstate = NbarState$new()
position = Position$new()
for(i in 1:3000)#nrow(data))
{
print(i)
d = data[i,]
position$update(d,nbarstate)
position = nbar_strategy(d,position,nbarstate)
nbarstate$update(d)
}
position$records
position$record
position$records
defaultstoploss = function(r,d,state,point=5)
{
stoploss = r$stoploss
type = r$type
high = as.numeric(d$High)
low = as.numeric(d$Low)
time = as.character(index(d))
newr = r
flag = F
if(type == 'long')
{
if(low <= stoploss)
{
newr$closetime = time
newr$close = stoploss
newr$exittype = 'longloss'
flag = T
}
}
else if(type == 'short')
{
if(high >= stoploss)
{
newr$closetime = time
newr$close = stoploss
newr$exittype = 'shortloss'
flag = T
}
}
result = list(flag = flag,r = newr)
return(result)
}
defaultstopwin = function(r,d,state,point=5)
{
stopwin = r$stopwin
type = r$type
high = as.numeric(d$High)
low = as.numeric(d$Low)
time = as.character(index(d))
newr = r
flag = F
if(type == 'long')
{
if(high >= stopwin)
{
newr$closetime = time
newr$close = stopwin
newr$exittype = 'longwin'
flag = T
}
}
else if(type == 'short')
{
if(low <= stopwin)
{
newr$closetime = time
newr$close = stopwin
newr$exittype = 'shortwin'
flag = T
}
}
result = list(flag = flag,r = newr)
return(result)
}
for(i in 1:nrow(data))
{}
nbarstate = NbarState$new()
position = Position$new()
for(i in 1:nrow(data))
{
print(i)
d = data[i,]
position$update(d,nbarstate)
position = nbar_strategy(d,position,nbarstate)
nbarstate$update(d)
}
records = position$records
records
records[1243,]
data['2008-05-09/2008-05-09 10:00:00']
nbarstate = NbarState$new()
position = Position$new()
for(i in 1:nrow(data))
{
print(i)
d = data[i,]
position = nbar_strategy(d,position,nbarstate)
position$update(d,nbarstate)
nbarstate$update(d)
}
records = position$records
records
records[1250,]
data['2008-05-13/2008-05-13 13:30:00']
profit = ifelse(records$type == 'long',(records$close - records$open),(records$open - records$close))
profit
sum(profit)
head(records)
head(profit)
win_ratio = length(profit[profit>0])/length(profit)
win_ratio
data['2003-08-07/2003-08-07 14:00:00']
head(records)
chartSeries(data['2003-08-07 14:00:00/2003-08-08 13:30:00'])
