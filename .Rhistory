data = orgin_data
cci = CCI(data$Cl,10)
cci = SMA(cci,5)
atr = ATR(data,10)
atr = atr$atr
data$atr = atr
data$cci = cci
data = na.omit(data)
chl_status = CHL_status$new()
chl_status$uplimit = 100
chl_status$downlimit = -100
position = Position$new()
winpoint = 15
losspoint = 15
pren = 3
pred = data[1:pren,]
for(i in (pren+1):nrow(data))
{
d = data[i,]
position = CHL_strategy(d,position,pred,chl_status,losspoint=losspoint,winpoint=winpoint,n=0)
position$update(d,NULL,iswinfirst=T)
chl_status$update(d)
pred = data[(i-pren+1):i,]
}
records = position$records
#records = position$getRecords()
basic_analysis(records)
source('src/config/include.R',encoding='utf-8')
sourceDir('src/dw/interface',encoding='utf-8')
source('src/dw/collectdata/collectfromwind.R',encoding='utf-8')
sourceDir('src/algorithm',encoding='utf-8')
source('src/strategy/shock/nbarclass.R',encoding='utf-8')
CHL_status = R6Class('nbarstate',
public = list(
precci = 0,
uplimit = 100,
downlimit = -100,
status = 'init',
initialize = function(precci=0)
{
self$precci = as.numeric(precci)
},
update = function(d)
{
cci = as.numeric(d$cci)
precci = self$precci
uplimit = self$uplimit
downlimit = self$downlimit
if(precci > downlimit && cci < downlimit)
{
status = 'short'
}
else if(precci<uplimit && cci > uplimit)
{
status = 'long'
}
else{
status = 'init'
}
self$status = status
self$precci = cci
}
)
)
CHL_strategy = function(d,position,pred,chlstatus,losspoint=10,winpoint=10,n=0)
{
time = as.character(index(d))
open = as.numeric(d$Open)
cci = as.numeric(d$cci)
curpostion = position
high = as.numeric(d$High)
low = as.numeric(d$Low)
prehigh = max(as.numeric(pred$High)) + n
prelow = min(as.numeric(pred$Low)) + n
status = chlstatus$status
if(status == 'long' && high > prehigh)
{
op = ifelse(open > prehigh,open,prehigh)
stoploss = op - losspoint
stopwin = op + winpoint
r = data.frame(opentime=time,closetime=NA,open=op,close=NA,stopwin=stopwin,stoploss=stoploss,type='long',exittype='')
trade = Trade$new(r,stopwin=defaultstopwin,stoploss=defaultstoploss)
curpostion$add(trade)
}
if(status == 'short' && low < prelow)
{
op = ifelse(open < prelow,open,prelow)
stoploss = op + losspoint
stopwin = op - winpoint
r = data.frame(opentime=time,closetime=NA,open=op,close=NA,stopwin=stopwin,stoploss=stoploss,type='short',exittype='')
trade = Trade$new(r,stopwin=defaultstopwin,stoploss=defaultstoploss)
curpostion$add(trade)
}
return(curpostion)
}
CHLframework = function()
{
dbname ='china_future_ods_m'
tbname = 'dlami'
freq = 15
orgin_data = getdata(dbname,tbname,freq)
data = orgin_data
cci = CCI(data$Cl,10)
cci = SMA(cci,5)
atr = ATR(data,10)
atr = atr$atr
data$atr = atr
data$cci = cci
data = na.omit(data)
chl_status = CHL_status$new()
chl_status$uplimit = 100
chl_status$downlimit = -100
position = Position$new()
winpoint = 15
losspoint = 15
pren = 3
pred = data[1:pren,]
for(i in (pren+1):nrow(data))
{
d = data[i,]
position = CHL_strategy(d,position,pred,chl_status,losspoint=losspoint,winpoint=winpoint,n=0)
position$update(d,NULL,iswinfirst=T)
chl_status$update(d)
pred = data[(i-pren+1):i,]
}
records = position$records
#records = position$getRecords()
basic_analysis(records)
}
data = orgin_data
cci = CCI(data$Cl,10)
cci = SMA(cci,5)
cci = CCI(data$Cl,10)
atr = ATR(data,10)
atr = atr$atr
data$atr = atr
data$cci = cci
data = na.omit(data)
?CCI
data = orgin_data
cci = CCI(data$Cl,10,na.omit=T)
cci = SMA(cci,5)
atr = ATR(data,10)
cci = SMA(cci,5,na.omit=T)
cci = SMA(cci,5,na.omit=T)
cci = SMA(na.omit(cci),5)
atr = ATR(data,10)
atr = atr$atr
data$atr = atr
data$cci = cci
data = na.omit(data)
chl_status = CHL_status$new()
chl_status$uplimit = 100
chl_status$downlimit = -100
position = Position$new()
winpoint = 15
losspoint = 15
pren = 3
pred = data[1:pren,]
for(i in (pren+1):nrow(data))
{
d = data[i,]
position = CHL_strategy(d,position,pred,chl_status,losspoint=losspoint,winpoint=winpoint,n=0)
position$update(d,NULL,iswinfirst=T)
chl_status$update(d)
pred = data[(i-pren+1):i,]
}
records = position$records
#records = position$getRecords()
basic_analysis(records)
data = orgin_data
cci = CCI(data$Cl,10)
cci = SMA(na.omit(cci),10)
atr = ATR(data,10)
atr = atr$atr
data$atr = atr
data$cci = cci
data = na.omit(data)
chl_status = CHL_status$new()
chl_status$uplimit = 100
chl_status$downlimit = -100
position = Position$new()
winpoint = 15
losspoint = 15
pren = 3
pred = data[1:pren,]
for(i in (pren+1):nrow(data))
{
d = data[i,]
position = CHL_strategy(d,position,pred,chl_status,losspoint=losspoint,winpoint=winpoint,n=0)
position$update(d,NULL,iswinfirst=T)
chl_status$update(d)
pred = data[(i-pren+1):i,]
}
records = position$records
#records = position$getRecords()
basic_analysis(records)
data = orgin_data
cci = CCI(data$Cl,10)
cci = SMA(na.omit(cci),3)
atr = ATR(data,10)
atr = atr$atr
data$atr = atr
data$cci = cci
data = na.omit(data)
chl_status = CHL_status$new()
chl_status$uplimit = 100
chl_status$downlimit = -100
position = Position$new()
winpoint = 15
losspoint = 15
pren = 3
pred = data[1:pren,]
for(i in (pren+1):nrow(data))
{
d = data[i,]
position = CHL_strategy(d,position,pred,chl_status,losspoint=losspoint,winpoint=winpoint,n=0)
position$update(d,NULL,iswinfirst=T)
chl_status$update(d)
pred = data[(i-pren+1):i,]
}
records = position$records
#records = position$getRecords()
basic_analysis(records)
data = orgin_data
cci = CCI(data$Cl,10)
cci = SMA(na.omit(cci),3)
atr = ATR(data,10)
atr = atr$atr
data$atr = atr
data$cci = cci
data = na.omit(data)
chl_status = CHL_status$new()
chl_status$uplimit = 120
chl_status$downlimit = -120
position = Position$new()
winpoint = 15
losspoint = 15
pren = 3
pred = data[1:pren,]
for(i in (pren+1):nrow(data))
{
d = data[i,]
position = CHL_strategy(d,position,pred,chl_status,losspoint=losspoint,winpoint=winpoint,n=0)
position$update(d,NULL,iswinfirst=T)
chl_status$update(d)
pred = data[(i-pren+1):i,]
}
records = position$records
#records = position$getRecords()
basic_analysis(records)
freq = 30
orgin_data = getdata(dbname,tbname,freq)
data = orgin_data
cci = CCI(data$Cl,10)
#cci = SMA(na.omit(cci),3)
atr = ATR(data,10)
atr = atr$atr
data$atr = atr
data$cci = cci
data = na.omit(data)
chl_status = CHL_status$new()
chl_status$uplimit = 100
chl_status$downlimit = -100
position = Position$new()
winpoint = 15
losspoint = 15
pren = 3
pred = data[1:pren,]
for(i in (pren+1):nrow(data))
{
d = data[i,]
position = CHL_strategy(d,position,pred,chl_status,losspoint=losspoint,winpoint=winpoint,n=0)
position$update(d,NULL,iswinfirst=T)
chl_status$update(d)
pred = data[(i-pren+1):i,]
}
records = position$records
#records = position$getRecords()
basic_analysis(records)
1544 + 1544*0.8
data = orgin_data
cci = CCI(data$Cl,10)
#cci = SMA(na.omit(cci),3)
atr = ATR(data,10)
atr = atr$atr
data$atr = atr
data$cci = cci
data = na.omit(data)
chl_status = CHL_status$new()
chl_status$uplimit = 100
chl_status$downlimit = -100
position = Position$new()
winpoint = 20
losspoint = 20
pren = 3
pred = data[1:pren,]
for(i in (pren+1):nrow(data))
{
d = data[i,]
position = CHL_strategy(d,position,pred,chl_status,losspoint=losspoint,winpoint=winpoint,n=0)
position$update(d,NULL,iswinfirst=T)
chl_status$update(d)
pred = data[(i-pren+1):i,]
}
records = position$records
#records = position$getRecords()
basic_analysis(records)
data = orgin_data
cci = CCI(data$Cl,10)
#cci = SMA(na.omit(cci),3)
atr = ATR(data,10)
atr = atr$atr
data$atr = atr
data$cci = cci
data = na.omit(data)
chl_status = CHL_status$new()
chl_status$uplimit = 100
chl_status$downlimit = -100
position = Position$new()
winpoint = 10
losspoint = 10
pren = 3
pred = data[1:pren,]
for(i in (pren+1):nrow(data))
{
d = data[i,]
position = CHL_strategy(d,position,pred,chl_status,losspoint=losspoint,winpoint=winpoint,n=0)
position$update(d,NULL,iswinfirst=T)
chl_status$update(d)
pred = data[(i-pren+1):i,]
}
records = position$records
#records = position$getRecords()
basic_analysis(records)
data = orgin_data
cci = CCI(data$Cl,10)
#cci = SMA(na.omit(cci),3)
atr = ATR(data,10)
atr = atr$atr
data$atr = atr
data$cci = cci
data = na.omit(data)
chl_status = CHL_status$new()
chl_status$uplimit = 100
chl_status$downlimit = -100
position = Position$new()
winpoint = 10
losspoint = 10
pren = 3
pred = data[1:pren,]
for(i in (pren+1):nrow(data))
{
d = data[i,]
position = CHL_strategy(d,position,pred,chl_status,losspoint=losspoint,winpoint=winpoint,n=0)
position$update(d,NULL,iswinfirst=F)
chl_status$update(d)
pred = data[(i-pren+1):i,]
}
records = position$records
#records = position$getRecords()
basic_analysis(records)
data = orgin_data
cci = CCI(data$Cl,10)
#cci = SMA(na.omit(cci),3)
atr = ATR(data,10)
atr = atr$atr
data$atr = atr
data$cci = cci
data = na.omit(data)
chl_status = CHL_status$new()
chl_status$uplimit = 100
chl_status$downlimit = -100
position = Position$new()
winpoint = 25
losspoint = 25
pren = 3
pred = data[1:pren,]
for(i in (pren+1):nrow(data))
{
d = data[i,]
position = CHL_strategy(d,position,pred,chl_status,losspoint=losspoint,winpoint=winpoint,n=0)
position$update(d,NULL,iswinfirst=F)
chl_status$update(d)
pred = data[(i-pren+1):i,]
}
records = position$records
#records = position$getRecords()
basic_analysis(records)
data = orgin_data
cci = CCI(data$Cl,10)
#cci = SMA(na.omit(cci),3)
atr = ATR(data,10)
atr = atr$atr
data$atr = atr
data$cci = cci
data = na.omit(data)
chl_status = CHL_status$new()
chl_status$uplimit = 100
chl_status$downlimit = -100
position = Position$new()
winpoint = 20
losspoint = 20
pren = 5
pred = data[1:pren,]
for(i in (pren+1):nrow(data))
{
d = data[i,]
position = CHL_strategy(d,position,pred,chl_status,losspoint=losspoint,winpoint=winpoint,n=0)
position$update(d,NULL,iswinfirst=F)
chl_status$update(d)
pred = data[(i-pren+1):i,]
}
records = position$records
#records = position$getRecords()
basic_analysis(records)
data = orgin_data
cci = CCI(data$Cl,10)
#cci = SMA(na.omit(cci),3)
atr = ATR(data,10)
atr = atr$atr
data$atr = atr
data$cci = cci
data = na.omit(data)
chl_status = CHL_status$new()
chl_status$uplimit = 100
chl_status$downlimit = -100
position = Position$new()
winpoint = 20
losspoint = 20
pren = 1
pred = data[1:pren,]
for(i in (pren+1):nrow(data))
{
d = data[i,]
position = CHL_strategy(d,position,pred,chl_status,losspoint=losspoint,winpoint=winpoint,n=0)
position$update(d,NULL,iswinfirst=F)
chl_status$update(d)
pred = data[(i-pren+1):i,]
}
records = position$records
#records = position$getRecords()
basic_analysis(records)
data = orgin_data
cci = CCI(data$Cl,10)
cci = SMA(na.omit(cci),3)
atr = ATR(data,10)
atr = atr$atr
data$atr = atr
data$cci = cci
data = na.omit(data)
chl_status = CHL_status$new()
chl_status$uplimit = 100
chl_status$downlimit = -100
position = Position$new()
winpoint = 20
losspoint = 20
pren = 3
pred = data[1:pren,]
for(i in (pren+1):nrow(data))
{
d = data[i,]
position = CHL_strategy(d,position,pred,chl_status,losspoint=losspoint,winpoint=winpoint,n=0)
position$update(d,NULL,iswinfirst=F)
chl_status$update(d)
pred = data[(i-pren+1):i,]
}
records = position$records
#records = position$getRecords()
basic_analysis(records)
data = orgin_data
cci = CCI(data$Cl,10)
cci = SMA(na.omit(cci),3)
atr = ATR(data,10)
atr = atr$atr
data$atr = atr
data$cci = cci
data = na.omit(data)
chl_status = CHL_status$new()
chl_status$uplimit = 80
chl_status$downlimit = -80
position = Position$new()
winpoint = 20
losspoint = 20
pren = 3
pred = data[1:pren,]
for(i in (pren+1):nrow(data))
{
d = data[i,]
position = CHL_strategy(d,position,pred,chl_status,losspoint=losspoint,winpoint=winpoint,n=0)
position$update(d,NULL,iswinfirst=F)
chl_status$update(d)
pred = data[(i-pren+1):i,]
}
records = position$records
#records = position$getRecords()
basic_analysis(records)
freq = 60
orgin_data = getdata(dbname,tbname,freq)
head(data)
data = orgin_data
head(data)
freq = 30
orgin_data = getdata(dbname,tbname,freq)
data = orgin_data
head(data)
head(data,100)
dbname ='china_future_ods_m'
tbname = 'dlami'
freq = 15
orgin_data = getdata(dbname,tbname,freq)
tail(orgin_data)
